name: Main

on:
  schedule:
    - cron: '0 4 * * 1,2,3,4,5'
  push:
    branches:
      - main
      - releases/*
    tags:
      - v*
  pull_request:
    branches:
      - main
      - releases/*
  workflow_dispatch:
    inputs:
      skip-test:
        description: 'Skip test'
        type: choice
        required: true
        default: 'false'
        options:
          - "true"
          - "false"

jobs:
  cleanup-odoo:
    runs-on: ubuntu-latest
    if: github.repository == 'kestra-io/plugin-odoo'
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Debug - Inspect build folder
        run: |
          echo "Current directory: $(pwd)"
          ls -lR plugin-odoo/build || echo "No build dir yet"

      - name: Cleanup - Remove build dir
        run: |
          rm -rf plugin-odoo/build

  check:
    uses: kestra-io/actions/.github/workflows/plugins.yml@main
    with:
      skip-test: ${{ github.event.inputs.skip-test == 'true' }}
    secrets: inherit
    needs: [cleanup-odoo]
